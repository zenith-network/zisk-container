From 3047e9a0b05bf09d8e08359ffc39cd42c27bf68c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andrzej=20Bro=C5=84ski?= <koxu1996@gmail.com>
Date: Tue, 14 Oct 2025 13:33:32 +0000
Subject: [PATCH] Increase gRPC decoding limit to 50MB.

---
 .../crates/coordinator/src/cli/handler_coordinator.rs     | 8 +++++++-
 distributed/crates/worker/src/worker_node.rs              | 5 ++++-
 2 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/distributed/crates/coordinator/src/cli/handler_coordinator.rs b/distributed/crates/coordinator/src/cli/handler_coordinator.rs
index 0f66fe3d..4af75401 100644
--- a/distributed/crates/coordinator/src/cli/handler_coordinator.rs
+++ b/distributed/crates/coordinator/src/cli/handler_coordinator.rs
@@ -50,9 +50,15 @@ pub async fn handle(
     let shutdown_signal = create_shutdown_signal();
 
     // Run the gRPC server with shutdown signal
+
+    // Set max message size for receiving large input data.
+    let max_message_size = 50 * 1024 * 1024; // 50MB
+    let service = ZiskDistributedApiServer::new(coordinator_service)
+        .max_decoding_message_size(max_message_size);
+
     tokio::select! {
         result = Server::builder()
-            .add_service(ZiskDistributedApiServer::new(coordinator_service))
+            .add_service(service)
             .serve(grpc_addr) => {
             match result {
                 Ok(_) => {
diff --git a/distributed/crates/worker/src/worker_node.rs b/distributed/crates/worker/src/worker_node.rs
index 109dea34..7523079e 100644
--- a/distributed/crates/worker/src/worker_node.rs
+++ b/distributed/crates/worker/src/worker_node.rs
@@ -112,7 +112,10 @@ impl WorkerNodeGrpc {
 
         let channel =
             Channel::from_shared(self.worker_config.coordinator.url.clone())?.connect().await?;
-        let mut client = zisk_distributed_api_client::ZiskDistributedApiClient::new(channel);
+        // Set max message size for receiving large input data.
+        let max_message_size = 50 * 1024 * 1024; // 50MB
+        let mut client = zisk_distributed_api_client::ZiskDistributedApiClient::new(channel)
+            .max_decoding_message_size(max_message_size);
 
         // Create bidirectional stream
         let (message_sender, message_receiver) = mpsc::unbounded_channel();
-- 
2.51.0

